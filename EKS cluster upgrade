Upgrade eks cluster from 1.22 to 1.23 :
Upgrade eksctl :
Set up to use Amazon EKS - Amazon EKS
You should have eksctl version 0.143.0 or greater to do the rest of the upgrades.
There are multiple API & Feature Removals in Kubernetes version 1.23. Please refer Kubernetes 1.23: The Next Frontier
This has effects on below components of the eks cluster.
Upgrade Cluster :
eksctl upgrade cluster --name=eksgendev-1 --region us-east-1
eksctl upgrade cluster --name=eksgendev-1 --region us-east-1 --approve
 
Upgrade Node Group :
eksctl upgrade nodegroup --name core-1675688423 --cluster eksgendev-1 --kubernetes-version=1.23 --region us-east-1
 
Refer the below URL and choose the kube-proxy image version as per the Kubernetes Version you are running on
Manage kube-proxy in Amazon EKS clusters - Amazon EKS
Check the current version of your kube-proxy deployment.
kubectl get daemonset kube-proxy --namespace kube-system -o=jsonpath='{$.spec.template.spec.containers[:1].image}'
kubectl set image daemonset.apps/kube-proxy -n kube-system kube-proxy=602401143452.dkr.ecr.us-east-1.amazonaws.com/eks/kube-proxy:v1.23.16-eksbuild.2

 
 
Refer the below URL and choose the core-dns version as per the Kubernetes Version you are running on
Manage CoreDNS for DNS in Amazon EKS clusters - Amazon EKS
Check the current version of your CoreDNS add-on
kubectl describe deployment coredns --namespace kube-system | grep Image | cut -d "/" -f 3
 
kubectl set image --namespace kube-system deployment.apps/coredns coredns=602401143452.dkr.ecr.us-east-1.amazonaws.com/eks/coredns:v1.8.7-eksbuild.5
 
To Update the awx-node in eks cluster
eksctl utils update-aws-node --cluster eksgendev-1 --approve --region us-east-1
 
Post Upgrade of the eks cluster, need to update the running kubectl version’s
You can get the update the rpm from the below link
Set up kubectl and eksctl - Amazon EKS
 
Login as user svc-ape in the bastion server dev, preprod, prod
curl -O https://s3.us-west-2.amazonaws.com/amazon-eks/1.23.17/2023-05-11/bin/linux/amd64/kubectl
chmod +x ./kubectl

 
sudo cp ./kubectl /usr/local/bin/kubectl
kubectl version --short --client
========= END==============
If Kubectl is installed for 1st time, configure the utility as below :
mkdir -p $HOME/bin && cp ./kubectl $HOME/bin/kubectl && export PATH=$PATH:$HOME/bin
echo 'export PATH=$PATH:$HOME/bin' >> ~/.bashrc
